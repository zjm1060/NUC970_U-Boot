/*
 * cmd_decrypt.c - decrypt image
 *
 * Copyright (c) 2014 Nuvoton technology
 *
 */

#include <common.h>
#include <command.h>

#include <asm/io.h>
#include "register.h"

//#define REG_MFP_GPA_L	0xB0000070
//#define REG_MFP_GPA_H	0xB0000074

#define REG_GPIOA_DIR	(GPIO_BA + 0)
#define REG_GPIOA_OUT	(GPIO_BA + 4)

#define CLK	9
#define DO	8
#define CS 	7
#define A0	6
#define RES 5
#define BLK	4

#define clrio(pin)	writel((readl(REG_GPIOA_OUT) & ~(1<<pin)), REG_GPIOA_OUT)
#define	setio(pin)	writel((readl(REG_GPIOA_OUT) | (1<<pin)), REG_GPIOA_OUT)

const char normal_image[1024]={
	0X00,0X7F,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X7F,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X1F,0X1F,0X1F,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X01,0X03,0X03,0X03,0X03,0X03,0X01,0X00,0X00,0X00,0X00,0X03,0X03,
	0X03,0X03,0X03,0X03,0X01,0X00,0X00,0X00,0X00,0X01,0X03,0X03,0X03,0X03,0X1F,0X1F,
	0X1F,0X00,0X00,0X00,0X03,0X03,0X33,0X33,0X33,0X00,0X00,0X00,0X00,0X00,0X03,0X03,
	0X03,0X03,0X03,0X03,0X03,0X01,0X00,0X00,0X00,0X00,0X01,0X03,0X03,0X03,0X03,0X03,
	0X01,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFE,0XFE,0XFE,0X06,0X06,0X06,0X06,0X06,0X06,
	0X00,0X00,0XF8,0XFC,0XFE,0X8E,0X06,0X8E,0XFE,0XFC,0XF8,0X00,0X00,0X3C,0X7E,0X7E,
	0X66,0X66,0X66,0XFE,0XFE,0XFE,0X00,0X00,0XF8,0XFC,0XFE,0X8E,0X06,0X8E,0XFE,0XFE,
	0XFE,0X00,0X00,0X00,0X06,0X06,0XFE,0XFE,0XFE,0X06,0X06,0X00,0X00,0X00,0XFE,0XFE,
	0XFE,0X80,0X00,0X80,0XFE,0XFE,0XFE,0X00,0X00,0XF8,0XFC,0XFE,0X8E,0X06,0X8E,0XFF,
	0XFF,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X60,0X60,0X60,0X60,0XE0,0XE0,
	0XC0,0X80,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X1F,0X11,0X11,0X11,0X11,0X51,0X31,0X11,0X11,0X11,0X11,0X1F,0X10,0X00,
	0X00,0X00,0X00,0X00,0X11,0X11,0X11,0X10,0X11,0X11,0X11,0X01,0X00,0X04,0X04,0X7F,
	0X04,0X04,0X04,0X07,0X00,0X00,0X00,0X00,0X00,0X07,0X04,0X04,0X04,0X04,0X04,0X7F,
	0X04,0X04,0X04,0X04,0X04,0X04,0X07,0X04,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X03,0XFE,0X00,0X00,0X1F,0X10,0X10,0X10,0X10,0X10,0X10,0X10,0X9F,0X80,0X00,
	0X00,0X00,0X00,0X02,0X07,0X1A,0X62,0XC2,0X02,0X14,0X0C,0X07,0X01,0X06,0XF8,0X80,
	0X00,0X00,0X01,0XFF,0X00,0X00,0X00,0X00,0X00,0XF0,0X20,0X20,0X20,0X20,0X20,0XFF,
	0X20,0X20,0X20,0X20,0X20,0X20,0XF0,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X20,
	0X40,0X80,0X00,0X00,0X00,0XC0,0X80,0X80,0X80,0X80,0X80,0X80,0X80,0XC0,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X20,0X40,0X80,0X00,0X00,0X00,0X00,
	0X40,0X60,0XC0,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XE0,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFE,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0XFE,0X00,};
const char update_image[1024]={
	0X00,0X7F,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X41,0X41,0X41,0X41,0X43,0X43,0X43,0X43,0X43,
	0X43,0X43,0X43,0X41,0X41,0X41,0X41,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,
	0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X40,0X7F,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X03,0X07,0X0F,0X0F,
	0X1F,0X3F,0X3E,0X7E,0XFC,0XF8,0XF8,0XF1,0XF3,0XF1,0XE0,0XE0,0XE0,0XE0,0XE7,0XE7,
	0XE0,0XE0,0XE0,0XE0,0XF1,0XF3,0XF1,0XF8,0XF8,0X7C,0X7E,0X3E,0X3F,0X1F,0X0F,0X0F,
	0X07,0X03,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X01,0X0F,0X1F,0X7F,0XFF,0XFE,0XF8,0XF0,0XC1,
	0X80,0X00,0X30,0X38,0X1C,0X08,0X00,0X00,0XE0,0XE0,0X40,0X00,0X00,0X00,0XC0,0XC0,
	0X00,0X00,0X00,0X40,0XE0,0XC0,0X00,0X00,0X08,0X1C,0X38,0X30,0X00,0X80,0XC1,0XF0,
	0XF8,0XFE,0XFF,0X7F,0X1F,0X07,0X01,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X01,
	0X01,0X01,0X01,0X01,0X01,0X01,0X1F,0XFF,0XFF,0XFF,0XFF,0XC1,0X01,0X01,0X81,0XC1,
	0XC1,0XE1,0X40,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X40,0XE3,0XC3,0XC3,0X83,
	0X03,0X00,0XC0,0XFF,0XFF,0XFF,0XFF,0X1F,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X80,
	0XC0,0XE0,0XF0,0XF8,0XFE,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFF,0XFE,0XF8,0XF0,0XE0,
	0XC0,0X80,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X0C,0X1C,0X0C,0X0E,0X04,
	0X00,0X01,0X0F,0XFF,0XFF,0XFF,0XFE,0XE0,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X03,0X03,
	0X03,0X03,0X03,0X03,0X03,0X03,0X83,0XC3,0XE3,0XC3,0X83,0X03,0X03,0X03,0X03,0X03,
	0X03,0X03,0X03,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X07,0X07,
	0X00,0X00,0X00,0X08,0X1F,0X0F,0X02,0X00,0X40,0XE0,0X71,0X31,0X03,0X07,0X0F,0X3F,
	0X7F,0XFF,0XFC,0XF8,0XE0,0XC0,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XC0,0XC0,
	0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,0XC0,
	0XC0,0XC0,0XC0,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X80,0X9F,
	0X1F,0X1F,0X1F,0X1E,0X3E,0X3E,0X3E,0X7C,0X7C,0XFC,0XF8,0XF0,0XF0,0XE0,0XC0,0XC0,
	0X80,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
	0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,
	0X00,0XFE,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,
	0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0X02,0XFE,0X00,
};

const char gImage_boot[1024] = { /* 0X02,0X01,0X80,0X00,0X40,0X00, */
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X3F,0X20,0X20,0X20,0X21,0X21,0X21,0X21,
0X21,0X21,0X21,0X20,0X20,0X20,0X20,0X20,0X20,0X20,0X20,0X21,0X21,0X21,0X20,0X20,
0X20,0X20,0X20,0X20,0X20,0X20,0X21,0X21,0X21,0X20,0X20,0X20,0X20,0X20,0X20,0X21,
0X21,0X21,0X21,0X21,0X21,0X21,0X20,0X20,0X20,0X20,0X20,0X20,0X20,0X20,0X20,0X20,
0X20,0X20,0X20,0X21,0X21,0X21,0X20,0X20,0X20,0X20,0X20,0X21,0X21,0X21,0X20,0X20,
0X20,0X20,0X21,0X21,0X21,0X20,0X20,0X20,0X20,0X21,0X21,0X21,0X21,0X21,0X21,0X20,
0X20,0X20,0X20,0X20,0X21,0X21,0X21,0X21,0X21,0X21,0X21,0X21,0X21,0X20,0X20,0X20,
0X20,0X3F,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,0X00,0X00,0X00,0XFF,0X04,0X04,
0X04,0X04,0X04,0X8A,0X71,0X00,0X00,0X00,0X1F,0X60,0X80,0X00,0X00,0X00,0X80,0X60,
0X1F,0X00,0X00,0X1F,0X60,0X80,0X00,0X00,0X00,0X80,0X60,0X1F,0X00,0X00,0XC0,0X00,
0X00,0X00,0XFF,0X00,0X00,0X00,0XC0,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0XFF,0XE0,0X1E,0X01,0X00,0X01,0X1E,0XE0,0XFF,0X00,0X00,0X1F,
0X60,0X80,0X00,0X00,0X00,0X80,0X60,0X1F,0X00,0X00,0XFF,0X00,0X00,0X00,0X00,0X80,
0X80,0X60,0X1F,0X00,0X00,0XFF,0X04,0X04,0X04,0X04,0X1F,0X00,0X80,0X40,0X00,0X00,
0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XFF,0X00,0X00,0X00,0X04,0XFC,0X04,0X04,
0X04,0X04,0X04,0X04,0X08,0XF0,0X00,0X00,0XC0,0X30,0X08,0X04,0X04,0X04,0X08,0X30,
0XC0,0X00,0X00,0XC0,0X30,0X08,0X04,0X04,0X04,0X08,0X30,0XC0,0X00,0X00,0X00,0X00,
0X00,0X04,0XFC,0X04,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X04,0XFC,0X04,0X00,0XE0,0X3C,0XE0,0X00,0X04,0XFC,0X04,0X00,0XC0,
0X30,0X08,0X04,0X04,0X04,0X08,0X30,0XC0,0X00,0X04,0XFC,0X04,0X04,0X04,0X04,0X08,
0X08,0X30,0XC0,0X00,0X04,0XFC,0X04,0X04,0X04,0X04,0X04,0X04,0X0C,0X30,0X00,0X00,
0X00,0XFF,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0XF8,0X08,0X08,0X08,0X08,0X08,0X08,0X08,
0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,
0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,
0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,
0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,
0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,
0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,0X08,
0X08,0XF8,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,
};

// static void udelay(int c)
// {
// 	int d = 10000;
// 	while(c--){
// 		d = 10000000;
// 		while(d--);
// 	}
// }

static void send(char c)
{
	int i;

	clrio(CS);
	udelay(1);
	for(i = 0; i < 8; i ++){
		clrio(CLK);
		if(c&0x80)
			setio(DO);
		else
			clrio(DO);

			udelay(1);	
		setio(CLK);

		c <<= 1;
		udelay(1);
	}
	udelay(1);
	setio(CS);
}

static void cmd(char c)
{
	clrio(A0);
	udelay(1);
	send(c);
}

static void data(char d)
{
	setio(A0);
	udelay(1);
	send(d);
}

static void lcd_init(void)
{
	const uint8_t Lcd_init_cmd[] = {0xe2,0xa2,0xa0,0xc0,0xa6,0x24,0x81,0x27,0x2f,0xaf};
	int i;

	writel(0, REG_MFP_GPA_L);	// pin A4~7 for gpio
	writel(0, REG_MFP_GPA_H);	// pin A8~9 for gpio
	writel(0x3f0,REG_GPIOA_DIR);

	// uint32_t reg = readl(REG_MFP_GPA_L);
	// printf("REG_MFP_GPA_L:%08X\n",reg);
	// reg = readl(REG_MFP_GPA_H);
	// printf("REG_MFP_GPA_H:%08X\n",reg);
	// reg = readl(REG_GPIOA_DIR);
	// printf("REG_GPIOA_DIR:%08X\n",reg);

	setio(BLK);

	clrio(RES);
	udelay(100);
	setio(RES);
	udelay(100);

	for(i = 0 ; i < sizeof(Lcd_init_cmd); i++){
		cmd(Lcd_init_cmd[i]);
	}
}

static void lcd_putImage(const char *image)
{
	const char _page[] = {0xb7,0xb6,0xb5,0xb4,0xb3,0xb2,0xb1,0xb0};
	int i,j;

	for(i = 0; i < 8 ; i++){
		cmd(_page[i]);
		cmd(0x10);
		cmd(0x00);

		for(j = 0; j < 128 ; j++){
			data(*(image+i*128+j));
		}
	}
}

int do_lcd(cmd_tbl_t *cmdtp, int flag, int argc, char * const argv[])
{
	const char *str_cmd;
	const char *pImage;
	
	if (argc < 2)
		return CMD_RET_USAGE;

	str_cmd = argv[1];

	if(*str_cmd == 'b'){
		pImage = normal_image;
	}else if(*str_cmd == 'u'){
		pImage = update_image;
	}else{
		return CMD_RET_USAGE;
	}

	lcd_init();

	lcd_putImage(pImage);

	return 0;
}

void lcd_in_boot(void)
{
	lcd_init();
	lcd_putImage(gImage_boot);
}

U_BOOT_CMD(lcd, 2, 0, do_lcd,
	"show lcd image",
	"");
